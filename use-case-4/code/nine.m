
scala> df.groupBy(substring(col("Date"),0,7).as("Year-Month")).agg(avg(col("Close"))).show(100)
+----------+------------------+
|Year-Month|        avg(Close)|
+----------+------------------+
|   2013-05| 77.81636368181817|
|   2013-09|        74.4395005|
|   2013-12|  78.7752382857143|
|   2013-06| 74.97800020000001|
|   2016-02| 66.24800044999999|
|   2015-05| 77.33599970000002|
|   2012-08| 73.04478265217392|
|   2015-12| 59.98681827272728|
|   2012-02|            60.898|
|   2012-04|60.149000150000006|
|   2016-12| 70.51904728571428|
|   2012-05|61.456363409090905|
|   2016-09| 72.00857180952381|
|   2016-03| 67.55499963636365|
|   2016-10| 69.23952366666666|
|   2012-12| 69.71100009999999|
|   2012-07| 72.40666661904763|
|   2014-01| 76.53142833333334|
|   2015-02| 85.52315805263159|
|   2015-08|  69.2866677142857|
|   2014-03| 75.30238076190474|
|   2014-08| 74.67666623809525|
|   2013-11| 78.97300075000001|
|   2014-02| 74.05578978947368|
|   2012-01|        60.2354999|
|   2015-10|61.564545636363626|
|   2012-11| 71.10952333333333|
|   2013-02| 70.62315857894738|
|   2015-11|58.911999949999995|
|   2014-09| 76.33619004761903|
|   2016-05| 68.05285676190476|
|   2012-06| 67.50380961904762|
|   2013-07| 77.11545418181818|
|   2014-05| 77.38095276190477|
|   2012-09| 74.18157921052631|
|   2015-01|       87.60949975|
|   2016-04| 68.82523861904761|
|   2016-11| 70.30476261904762|
|   2013-08| 75.22409204545455|
|   2014-11| 81.88526321052632|
|   2016-01| 63.22105263157895|
|   2016-07| 73.54149939999999|
|   2015-07| 72.75000036363635|
|   2016-06| 71.34636304545454|
|   2014-04| 77.80857085714285|
|   2014-10| 76.48869486956522|
|   2015-09| 64.25238128571429|
|   2014-12|  85.1259102727273|
|   2013-03| 73.43649940000002|
|   2013-10| 74.97913104347826|
|   2014-06| 76.01000033333332|
|   2012-10| 75.30619061904761|
|   2014-07| 76.21090877272728|
|   2015-04| 79.56047561904764|
|   2015-06| 72.79727304545456|
|   2013-01| 69.09476142857143|
|   2016-08|  72.8300000869565|
|   2013-04| 77.68954572727273|
|   2012-03|60.433636818181796|
|   2015-03| 82.47318172727273|
+----------+------------------+


